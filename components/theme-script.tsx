import { BLOG_SLUGS_BY_LOCALE, PROJECT_SLUGS_BY_LOCALE } from "@/data/content-index"
import { LOCALES } from "@/lib/i18n"

export function ThemeScript() {
  const script = `(function(){try{var STORAGE_KEY='theme';var root=document.documentElement;var mediaQuery=window.matchMedia('(prefers-color-scheme: dark)');var locales=${JSON.stringify(
    LOCALES
  )};var projectSlugsByLocale=${JSON.stringify(
    PROJECT_SLUGS_BY_LOCALE
  )};var blogSlugsByLocale=${JSON.stringify(
    BLOG_SLUGS_BY_LOCALE
  )};function isLocale(value){return locales.indexOf(value)!==-1;}function normalizePath(pathname){if(!pathname||pathname==='/'){return '/';}var normalized=pathname.charAt(0)==='/'?pathname:'/'+pathname;return normalized.length>1&&normalized.endsWith('/')?normalized.slice(0,-1):normalized;}function pathWithoutLocale(pathname){var normalized=normalizePath(pathname);var segments=normalized.split('/').filter(Boolean);if(segments.length===0){return '/';}if(isLocale(segments[0])){if(segments.length===1){return '/';}return '/'+segments.slice(1).join('/');}return normalized;}function localePath(locale,path){if(path==='/'){return '/'+locale;}return '/'+locale+path;}function resolveLocaleSwitchPath(pathname,targetLocale){var path=pathWithoutLocale(pathname);if(path==='/'){return localePath(targetLocale,'/');}var segments=path.split('/').filter(Boolean);if(segments.length===1){var top=segments[0];if(top==='projects'||top==='blog'||top==='resume'){return localePath(targetLocale,'/'+top);}return localePath(targetLocale,'/');}if(segments.length>=2&&segments[0]==='projects'){var projectSlug=segments[1];var projectSlugs=projectSlugsByLocale[targetLocale]||[];if(projectSlugs.indexOf(projectSlug)!==-1){return localePath(targetLocale,'/projects/'+projectSlug);}return localePath(targetLocale,'/');}if(segments.length>=2&&segments[0]==='blog'){var blogSlug=segments[1];var blogSlugs=blogSlugsByLocale[targetLocale]||[];if(blogSlugs.indexOf(blogSlug)!==-1){return localePath(targetLocale,'/blog/'+blogSlug);}return localePath(targetLocale,'/');}return localePath(targetLocale,'/');}function updateLocaleSwitcherLinks(){var pathname=normalizePath(window.location.pathname);var segments=pathname.split('/').filter(Boolean);var currentLocale=segments.length>0&&isLocale(segments[0])?segments[0]:null;var localeOptions=document.querySelectorAll('.js-locale-option');for(var i=0;i<localeOptions.length;i+=1){var option=localeOptions[i];if(!(option instanceof HTMLAnchorElement)){continue;}var targetLocale=option.getAttribute('data-target-locale');if(!targetLocale||!isLocale(targetLocale)){continue;}option.setAttribute('href',resolveLocaleSwitchPath(pathname,targetLocale));var isCurrent=targetLocale===currentLocale;option.classList.toggle('locale-dropdown-option-active',isCurrent);if(isCurrent){option.setAttribute('aria-current','true');}else{option.removeAttribute('aria-current');}}}function updateActiveNav(){var pathname=normalizePath(window.location.pathname);var navLinks=document.querySelectorAll('.js-site-nav-link');for(var i=0;i<navLinks.length;i+=1){var link=navLinks[i];if(!(link instanceof HTMLAnchorElement)){continue;}var href=link.getAttribute('href')||'/';var hrefPath=normalizePath(new URL(href,window.location.origin).pathname);var navKey=link.getAttribute('data-nav-key');var isHome=navKey==='home';var isActive=isHome?pathname===hrefPath:pathname===hrefPath||pathname.indexOf(hrefPath+'/')===0;link.classList.toggle('site-nav-link-active',isActive);if(isActive){link.setAttribute('aria-current','page');}else{link.removeAttribute('aria-current');}}}function setupHeaderVisibility(){var header=document.querySelector('.js-site-header');if(!(header instanceof HTMLElement)){return;}var threshold=6;var lastScrollY=window.scrollY;function setVisibility(isVisible){header.classList.toggle('site-header-visible',isVisible);header.classList.toggle('site-header-hidden',!isVisible);}function handleScroll(){var currentScrollY=window.scrollY;if(currentScrollY<=0){setVisibility(true);lastScrollY=0;return;}var delta=currentScrollY-lastScrollY;if(Math.abs(delta)<threshold){return;}setVisibility(delta<0);lastScrollY=currentScrollY;}setVisibility(true);window.addEventListener('scroll',handleScroll,{passive:true});}function getTheme(){var saved=localStorage.getItem(STORAGE_KEY);if(saved==='light'||saved==='dark'){return saved;}return mediaQuery.matches?'dark':'light';}function getCurrentTheme(){return root.getAttribute('data-theme')==='dark'?'dark':'light';}function updateToggle(theme){var toggles=document.querySelectorAll('.js-theme-toggle');for(var i=0;i<toggles.length;i+=1){var toggle=toggles[i];var lightLabel=toggle.getAttribute('data-light-label')||'Light';var darkLabel=toggle.getAttribute('data-dark-label')||'Dark';var nextLabel=theme==='dark'?lightLabel:darkLabel;toggle.textContent=nextLabel;toggle.setAttribute('aria-label',nextLabel);}}function syncToggleLabel(){updateToggle(getCurrentTheme());}function applyTheme(theme,persist){root.setAttribute('data-theme',theme);if(persist){localStorage.setItem(STORAGE_KEY,theme);}updateToggle(theme);}function toggleTheme(){var current=getCurrentTheme();var next=current==='dark'?'light':'dark';applyTheme(next,true);}function runUiEnhancements(){syncToggleLabel();updateLocaleSwitcherLinks();updateActiveNav();setupHeaderVisibility();}function setupRouteListeners(){if(window.__cleissonomUiRouteListenersAttached){return;}window.__cleissonomUiRouteListenersAttached=true;var previousPathname=normalizePath(window.location.pathname);function refreshNavigationState(){var nextPathname=normalizePath(window.location.pathname);if(nextPathname===previousPathname){return;}previousPathname=nextPathname;updateLocaleSwitcherLinks();updateActiveNav();}var originalPushState=window.history.pushState;var originalReplaceState=window.history.replaceState;window.history.pushState=function(){var result=originalPushState.apply(window.history,arguments);window.setTimeout(refreshNavigationState,0);return result;};window.history.replaceState=function(){var result=originalReplaceState.apply(window.history,arguments);window.setTimeout(refreshNavigationState,0);return result;};window.addEventListener('popstate',function(){window.setTimeout(refreshNavigationState,0);});}function runPostHydrationEnhancements(){runUiEnhancements();setupRouteListeners();}function schedulePostHydrationEnhancements(){var hasRun=false;var observer;var runTimeoutId;function cleanup(){if(observer){observer.disconnect();observer=undefined;}if(typeof runTimeoutId==='number'){window.clearTimeout(runTimeoutId);runTimeoutId=undefined;}}function runOnce(){if(hasRun){return;}hasRun=true;cleanup();runPostHydrationEnhancements();}function queueRun(){runTimeoutId=window.setTimeout(runOnce,0);}function hasHydratedApp(){return Boolean(document.getElementById('__next-route-announcer__')||document.querySelector('next-route-announcer')||document.getElementsByName('next-route-announcer')[0]);}if(hasHydratedApp()){queueRun();return;}if(document.readyState==='complete'){queueRun();}else{window.addEventListener('load',queueRun,{once:true});}observer=new MutationObserver(function(){if(hasHydratedApp()){queueRun();}});observer.observe(document.documentElement,{childList:true,subtree:true});window.addEventListener('beforeunload',cleanup,{once:true});}applyTheme(getTheme(),false);schedulePostHydrationEnhancements();document.addEventListener('click',function(event){var target=event.target;if(target instanceof Element){var toggle=target.closest('.js-theme-toggle');if(toggle){event.preventDefault();toggleTheme();}}});if(typeof mediaQuery.addEventListener==='function'){mediaQuery.addEventListener('change',function(){if(!localStorage.getItem(STORAGE_KEY)){applyTheme(mediaQuery.matches?'dark':'light',false);}});}else if(typeof mediaQuery.addListener==='function'){mediaQuery.addListener(function(){if(!localStorage.getItem(STORAGE_KEY)){applyTheme(mediaQuery.matches?'dark':'light',false);}});}}catch(e){document.documentElement.setAttribute('data-theme','light');}})();`

  return <script dangerouslySetInnerHTML={{ __html: script }} />
}
